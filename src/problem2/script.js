const svgs = [
    '1INCH.svg',
    'AAVE.svg',
    'ACT.svg',
    'ADA.svg',
    'AEVO.svg',
    'AGI.svg',
    'AI16Z.svg',
    'AIXBT.svg',
    'AKRO.svg',
    'AKT.svg',
    'ALGO.svg',
    'ALPHA.svg',
    'ALT.svg',
    'AMP.svg',
    'ampKUJI.svg',
    'ampLUNA.svg',
    'ANC.svg',
    'ANDR.svg',
    'ANKR.svg',
    'ANT.svg',
    'ANY.svg',
    'APE.svg',
    'APOLLO.svg',
    'APT.svg',
    'AR.svg',
    'ARB.svg',
    'ARCH.svg',
    'ASA.svg',
    'ASTRO.svg',
    'ATOM-dATOM.svg',
    'ATOM.svg',
    'AUDIO.svg',
    'AUT.svg',
    'AVA.svg',
    'AVAIL.svg',
    'AVAX.svg',
    'AXL.svg',
    'axlUSDC.svg',
    'AXS.svg',
    'AXT.svg',
    'BAKE.svg',
    'BAL.svg',
    'BAND.svg',
    'BAT.svg',
    'BCD.svg',
    'bCFX.svg',
    'BCH.svg',
    'BCHA.svg',
    'BCN.svg',
    'BCNA.svg',
    'BELT.svg',
    'BHC.svg',
    'BIT.svg',
    'BLAST.svg',
    'BLD.svg',
    'BLOX.svg',
    'BLUR.svg',
    'BNB.svg',
    'bNEO.svg',
    'BNT.svg',
    'BOLT.svg',
    'BONK.svg',
    'BOOT.svg',
    'BRAINS.svg',
    'BRETT.svg',
    'BRKL.svg',
    'BTC.svg',
    'BTCST.svg',
    'BTG.svg',
    'BTM.svg',
    'BTMX.svg',
    'BTSG.svg',
    'BTT.svg',
    'BUNNY.svg',
    'BUSD.svg',
    'BUSDT.svg',
    'C98.svg',
    'CAKE.svg',
    'CANTO.svg',
    'CARB.svg',
    'CAT.svg',
    'cbBTC.svg',
    'cbETH.svg',
    'CEL.svg',
    'CELO.svg',
    'CETH.svg',
    'CFX.svg',
    'CGAS.svg',
    'cGLP.svg',
    'CHEQ.svg',
    'CHSB.svg',
    'CHT.svg',
    'CHZ.svg',
    'CKB.svg',
    'CLP.svg',
    'CMDX.svg',
    'cmETH.svg',
    'CMST.svg',
    'CNT.svg',
    'COIN.svg',
    'COMP.svg',
    'COOK.svg',
    'CRBRUS.svg',
    'CRE.svg',
    'CRO.svg',
    'CRV.svg',
    'CTK.svg',
    'cUSD.svg',
    'CW.svg',
    'DAG.svg',
    'DAI.svg',
    'DARC.svg',
    'DASH.svg',
    'dATOM.svg',
    'DBC.svg',
    'DCR.svg',
    'DEC.svg',
    'DEGEN.svg',
    'DENT.svg',
    'DGB.svg',
    'DIG.svg',
    'dINJ.svg',
    'DKT.svg',
    'DODO.svg',
    'DOGE.svg',
    'DOT.svg',
    'DPX.svg',
    'DRFT.svg',
    'DSM.svg',
    'DVPN.svg',
    'dXCAD.svg',
    'DYDX.svg',
    'DYM.svg',
    'EEUR.svg',
    'eGLD.svg',
    'EIGEN.svg',
    'ELA.svg',
    'ELF.svg',
    'ENA.svg',
    'ENJ.svg',
    'ENS.svg',
    'EOS.svg',
    'ePLAY.svg',
    'EPS.svg',
    'esFLUO.svg',
    'ETC.svg',
    'ETH.svg',
    'ETHBTC.svg',
    'ETN.svg',
    'EUROC.svg',
    'EUT.svg',
    'EVMOS.svg',
    'EWT.svg',
    'FARTCOIN.svg',
    'FBTC.svg',
    'FEES.svg',
    'FET.svg',
    'FIL.svg',
    'FIS.svg',
    'FLIX.svg',
    'FLM.svg',
    'FLOW.svg',
    'FLUID.svg',
    'FLUO.svg',
    'FRANK.svg',
    'FSGLP.svg',
    'FTM.svg',
    'FTT.svg',
    'FTTC.svg',
    'FUN.svg',
    'GALA.svg',
    'GAS.svg',
    'GBT.svg',
    'GLP.svg',
    'GM.svg',
    'GMX.svg',
    'GNO.svg',
    'GNS.svg',
    'GOAT.svg',
    'GRASS.svg',
    'GRAV.svg',
    'GRT.svg',
    'GT.svg',
    'gZIL.svg',
    'HBAR.svg',
    'HDN.png',
    'HDN.svg',
    'HELMET.svg',
    'HKT.svg',
    'HNT.svg',
    'HOPE.svg',
    'HOT.svg',
    'HT.svg',
    'HUAHUA.svg',
    'HUNY.svg',
    'HUSD.svg',
    'HYPE.svg',
    'IBCX.svg',
    'ICP.svg',
    'ICX.svg',
    'IDT.svg',
    'INJ.svg',
    'INT.svg',
    'ION.svg',
    'IOST.svg',
    'IOTX.svg',
    'IOV.svg',
    'IRIS.svg',
    'iSEI.svg',
    'iUSD.svg',
    'IXO.svg',
    'JPT.svg',
    'JTO.svg',
    'JUNO.svg',
    'JUP.svg',
    'KAS.svg',
    'KBONK.svg',
    'KCS.svg',
    'KFLOKI.svg',
    'KLAY.svg',
    'KMD.svg',
    'KNC.svg',
    'KPEPE.svg',
    'KRT.svg',
    'KSHIB.svg',
    'KSM.svg',
    'KUJI.svg',
    'LBTC.svg',
    'LDO.svg',
    'LEO.svg',
    'LET.svg',
    'LIKE.svg',
    'LINK.svg',
    'Liquid Staking Index.svg',
    'LKT.svg',
    'LOOM.svg',
    'LOOP.svg',
    'LOTA.svg',
    'LPcmETH_13FEB2025.svg',
    'LPLBTC_29MAY2025.svg',
    'LPT.svg',
    'LRC.svg',
    'LSI.svg',
    'LSK.svg',
    'LTC.svg',
    'LUM.svg',
    'LUNA.svg',
    'LUNAX.svg',
    'LUNC.svg',
    'LUNI.svg',
    'LUNR.svg',
    'LUV.svg',
    'LVN.svg',
    'M87.svg',
    'MANA.svg',
    'MANTA.svg',
    'MARBLE.svg',
    'MATH.svg',
    'MATIC.svg',
    'MDX.svg',
    'ME.svg',
    'MED.svg',
    'MEME.svg',
    'mETH.svg',
    'METIS.svg',
    'MEW.svg',
    'MIAW.svg',
    'milkTIA.svg',
    'MINA.svg',
    'MINE.svg',
    'MIOTA.svg',
    'MIR.svg',
    'MKR.svg',
    'MMOG.svg',
    'MNT.svg',
    'MNTA.svg',
    'MNTL.svg',
    'MOODENG.svg',
    'MORPHO.svg',
    'MYT.svg',
    'NANO.svg',
    'NAS.svg',
    'NEAR.svg',
    'NEIROETH.svg',
    'NEO.svg',
    'NETA.svg',
    'NEX.svg',
    'NEXO.svg',
    'NGM.svg',
    'NIM.svg',
    'NKN.svg',
    'NMR.svg',
    'nNEO.svg',
    'NOT.svg',
    'NOTE.svg',
    'NTRN-dATOM.svg',
    'NTRN.svg',
    'NXM.svg',
    'OCEAN.svg',
    'OCH.svg',
    'OGN.svg',
    'OKB.svg',
    'OKT.svg',
    'OM.svg',
    'OMG.svg',
    'OMG_2.svg',
    'OMI.svg',
    'OMNI.svg',
    'ONDO.svg',
    'ONE.svg',
    'ONT.svg',
    'OP.svg',
    'OPUL.svg',
    'ORDI.svg',
    'ORION.svg',
    'ORNE.svg',
    'OSMO.svg',
    'OXT.svg',
    'OXY.svg',
    'PAX.svg',
    'PENDLE.svg',
    'PENGU.svg',
    'PEPE.svg',
    'PHT.svg',
    'PLAY.svg',
    'PLQ.svg',
    'PLY.svg',
    'PNUT.svg',
    'POLY.svg',
    'POPCAT.svg',
    'PORT.svg',
    'PROM.svg',
    'PSI.svg',
    'PSTAKE.svg',
    'PTcmETH_13FEB2025.svg',
    'PTLBTC_29MAY2025.svg',
    'PTMETH_26DEC2024.svg',
    'PUDGY.svg',
    'PUNDIX.svg',
    'PURR.svg',
    'PURSE.svg',
    'PYTH.svg',
    'QCK.svg',
    'QKC.svg',
    'QNT.svg',
    'QTUM.svg',
    'rATOM.svg',
    'RAY.svg',
    'RBN.svg',
    'REEF.svg',
    'REGEN.svg',
    'REN.svg',
    'REP.svg',
    'REV.svg',
    'RLB.svg',
    'RLC.svg',
    'RNDR.svg',
    'ROAR.svg',
    'ROWAN.svg',
    'RSR.svg',
    'rSWTH.svg',
    'RUNE.svg',
    'RVN.svg',
    'SAFEMOON.svg',
    'SAGA.svg',
    'SAND.svg',
    'sARCH.svg',
    'SAYVE.svg',
    'SC.svg',
    'SCRT.svg',
    'SDT.svg',
    'SEI.svg',
    'SET.svg',
    'SGT.svg',
    'SHD.svg',
    'SHIB.svg',
    'SHIDO.svg',
    'SITY.svg',
    'SLERF.svg',
    'SNT.svg',
    'SNX.svg',
    'SOL.svg',
    'SOLETH.svg',
    'SOM.svg',
    'SOMM.svg',
    'SPEC.svg',
    'SRM.svg',
    'SRV.svg',
    'STARS.svg',
    'stATOM.svg',
    'stDYDX.svg',
    'stDYM.svg',
    'STEEM.svg',
    'stETH.svg',
    'stEVMOS.svg',
    'stFLUO.svg',
    'stIBCX.svg',
    'stINJ.svg',
    'stJUNO.svg',
    'stkATOM.svg',
    'stkDYDX.svg',
    'stkSTARS.svg',
    'stLUNA.svg',
    'STMX.svg',
    'stOKT.svg',
    'STORJ.svg',
    'stOSMO.svg',
    'STRAX.svg',
    'STRD.svg',
    'STREAM.svg',
    'STRK.svg',
    'stSAGA.svg',
    'stSTARS.svg',
    'STT.svg',
    'stTIA.svg',
    'STX.svg',
    'stZIL.svg',
    'SUI.svg',
    'SUN.svg',
    'SUSHI.svg',
    'SWTH-LEGACY.svg',
    'SWTH.svg',
    'SXP.svg',
    'TAO.svg',
    'TEL.svg',
    'TFUEL.svg',
    'THETA.svg',
    'THT.svg',
    'TIA.svg',
    'TICK.svg',
    'TITAN.svg',
    'TLAND.svg',
    'TLM.svg',
    'Token.svg',
    'TOMO.svg',
    'TON.svg',
    'TPC.svg',
    'TRAXX.svg',
    'TRB.svg',
    'TRU.svg',
    'TRX.svg',
    'TTT.svg',
    'TUSD.svg',
    'TWD.svg',
    'TWT.svg',
    'UBQ.svg',
    'UMEE.svg',
    'UNA.svg',
    'UNI.svg',
    'UOS.svg',
    'USC-Minted.svg',
    'USC.svg',
    'USD.svg',
    'USDC-dATOM.svg',
    'USDC.e.svg',
    'USDC.grv.svg',
    'USDC.svg',
    'USDP.svg',
    'USDT.svg',
    'USDY.svg',
    'USK.svg',
    'UST.svg',
    'USUAL.svg',
    'VDL.svg',
    'veFLUO.svg',
    'VET.svg',
    'VIRTUAL.svg',
    'VKR.svg',
    'VRTX.svg',
    'vZWAP.svg',
    'W.svg',
    'WAVE.svg',
    'WBNB.svg',
    'WBTC.svg',
    'WETH.svg',
    'WHALE.svg',
    'WIF.svg',
    'WIN.svg',
    'wKAS.svg',
    'WLD.svg',
    'WMATIC.svg',
    'WRX.svg',
    'wstETH.svg',
    'XCAD.svg',
    'XDC.svg',
    'XEM.svg',
    'XKI.svg',
    'XLM.svg',
    'XMR.svg',
    'XPRT.svg',
    'XRP.svg',
    'XSGD.svg',
    'XTRA.svg',
    'XTZ.svg',
    'XVG.svg',
    'XVS.svg',
    'YAM.svg',
    'YFI.svg',
    'YieldUSD.svg',
    'ZCH.svg',
    'ZEC.svg',
    'ZEN.svg',
    'ZIL.svg',
    'ZRO.svg',
    'ZRX.svg',
    'ZWAP.svg'
];
const menuIds = [1, 2];
function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}

const exchangeRateUrl = 'https://interview.switcheo.com/prices.json';

function toggleMenu(form) {
    for (const id of menuIds) {
        if (id !== form && isOpen(id)) {
            removeMenu();
            const submenu = document.getElementById(`subMenu-${id}`);
            submenu.classList.remove('open');
            const button = document.getElementById(`arrow-${id}`);
            button.classList.remove('rotate');
        }
    }
    const submenu = document.getElementById(`subMenu-${form}`);
    submenu.classList.toggle('open');
    const button = document.getElementById(`arrow-${form}`);
    button.classList.toggle('rotate');

    if (submenu.classList.contains('open')) {
        addSvgs(form);
    } else {
        removeMenu();
    }
}

function swapDirection() {
    const lhsCurrency = document.getElementById('curr-name-1').textContent;
    const rhsCurrency = document.getElementById('curr-name-2').textContent;
    swapCurrency(1, `icons/${rhsCurrency}.svg`, lhsCurrency);
    swapCurrency(2, `icons/${lhsCurrency}.svg`, rhsCurrency);
    document.getElementById('curr-name-1').textContent = rhsCurrency;
    document.getElementById('curr-name-2').textContent = lhsCurrency;
    if (document.getElementById('amount').value !== '') {
        convert();
    }
}

function isOpen(dropdownid) {
    const submenu = document.getElementById(`subMenu-${dropdownid}`);
    return submenu.classList.contains('open');
}

function removeMenu() {
    const svgListDiv = document.querySelectorAll('.list-item');
    svgListDiv.forEach((item) => item.remove());
}

async function addSvgs(form) {
    const currencyList = await fetch(exchangeRateUrl)
        .then((response) => response.json())
        .then((data) => {
            return data.map((item) => item.currency);
        })
        .catch((error) => console.error(error));
    const svgListDiv = document.getElementById(`mylist-${form}`);
    svgs.forEach((file) => {
        if (!currencyList.includes(file.split('.')[0])) return;
        const listItem = document.createElement('div');
        listItem.classList.add('list-item');
        const svgImg = document.createElement('img');
        svgImg.src = `icons/${file}`;
        svgImg.alt = file;
        listItem.onclick = () => {
            console.log(`Clicked on: ${file.split('.')[0]}`);
            swapCurrency(form, `icons/${file}`, file.split('.')[0]);
            toggleMenu(form);
        };
        const currencyName = document.createElement('span');
        currencyName.textContent = file.split('.')[0];
        listItem.appendChild(svgImg);
        listItem.appendChild(currencyName);
        svgListDiv.appendChild(listItem);
    });
}

async function swapCurrency(form, newIcon, name) {
    const icon = document.getElementById(`curr-${form}`);
    icon.src = newIcon;
    const currencyNameElement = document.getElementById(`curr-name-${form}`);
    currencyNameElement.textContent = name;
    const originalText = 'Convert';
    try {
        if ((await validateInput(document.getElementById('amount').value)) === false) return;
        const submitButton = document.getElementById('submit');
        submitButton.innerHTML = '<span class="loading-indicator"></span>';
        submitButton.disabled = true;
        await convert();
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    } catch (error) {
        console.log(error);
    }
}

function handleFocus(form) {
    const formChild = document.getElementsByClassName('form-child').item(form);
    formChild.classList.toggle('focus');
}

async function convert() {
    const amountInput = document.getElementById('amount').value;
    const lhsCurrency = document.getElementById('curr-name-1').textContent;
    const rhsCurrency = document.getElementById('curr-name-2').textContent;
    const currencyList = await fetch(exchangeRateUrl)
        .then((response) => response.json())
        .then((data) => {
            return data;
        })
        .catch((error) => console.error(error));
    await sleep(1000);
    lhsPrice = currencyList.find((item) => item.currency === lhsCurrency).price;
    rhsPrice = currencyList.find((item) => item.currency === rhsCurrency).price;
    const conversionRate = lhsPrice / rhsPrice;
    const convertedValue = (amountInput * conversionRate).toFixed(6);
    document.getElementById('amount-2').value = convertedValue;
}

document.getElementById('currencyExchangeForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    if ((await validateInput(document.getElementById('amount').value)) === false) return;
    const submitButton = document.getElementById('submit');
    const originalText = submitButton.textContent;
    submitButton.innerHTML = '<span class="loading-indicator"></span>';
    submitButton.disabled = true;
    try {
        await convert();
    } catch (error) {
        console.log(error);
    } finally {
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    }
});

async function validateInput(amount) {
    if (amount === '') {
        const formChild = document.getElementsByClassName('form-child').item(0);
        const amountInput = document.getElementById('amount');
        formChild.classList.toggle('error');
        amountInput.classList.toggle('error');
        amountInput.disabled = true;
        await sleep(1000);
        amountInput.disabled = false;
        amountInput.classList.toggle('error');
        formChild.classList.toggle('error');
        return false;
    }
    return true;
}
